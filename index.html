---
layout: default
title: Algorotoscope Images Working
---

{% assign count = 0 %}
{% assign images = site.data.images | sort: 'title' %}

<h4>Algorotoscope Images Working Area</h4>
<form id="all-images" style="padding: 0px; margin: 0px; width: 100%;">
<div class="box alt">
	<div class="row 50% uniform">
		{% for image in images %}
			<div class="4u">
				<span class="image fit">
					<a href="{{ image.url }}" target="_blank">
						<img src="{{ image.image }}" alt="" height="150" />
					</a>
					<table style="padding: 0px; margin: 0px;">
						<tr>
							<td><strong>Title:</strong></td>
							<td><input type="text" name="title" id="title-{{ count }}" value="{{ image.title }}" style="width:98%;" /></td>
						</tr>
						<tr>
							<td><strong>Tags:</strong></td>
							<td><input type="text" name="tags" id="tags-{{ count }}" value="{{ image.tags }}" style="width:98%;" /></td>
						</tr>
					</table>
					<input type="hidden" name="image" id="image-{{ count }}" value="{{ image.image }}" />
				</span>
			</div>
			{% assign count = count | plus: 1 %}
		{% endfor %}
	</div>
</div>
</form>

<div class="box alt">
	<div class="row 50% uniform">

		<script type="text/javascript">
		function savethis()
			{
	    var $oAuthToken = getUrlVar('token');
	    var $org = '{{ site.github_user }}';
	    var $repo = '{{ site.github_repo }}';
			var $branch = '{{ site.github_branch }}';

			if($oAuthToken !='')
	      {
	      Cookies.set('token', $oAuthToken);
	      // Set with expiration
	      // Cookies.set('token', $oAuthToken, { expires: '01/01/2017' });
	      }

	    // Grab the token from cookie
	    $oAuthToken = Cookies.get('token');

			$images = new Array();
			var elements = document.getElementById("all-images").elements;
			for (var i = 0, element; element = elements[i++];)
				{
		    if (element.type === "text" || element.type === "hidden")
					{
					if(element.name == 'title')
						{
						$i = {};
						}

		      //console.log(element.name);

					$i[element.name] = element.value;

					if(element.name == 'image')
						{
						$images.push($i);
						}
					}
				}
			//console.log($images);
			$yaml_dump = jsyaml.dump($images);

			//document.getElementById('source').value = $yaml_dump;

			// Grab the token from cookie
			$oAuthToken = Cookies.get('token');

			var github = new Github({token: $oAuthToken,auth: "oauth"});
			var repo = github.getRepo($org,$repo);

			repo.getTree('{{ site.github_branch }}?recursive=true', function(err, tree) {

				$.each(tree, function(treeKey, treeValue) {

					$writepath = '_data/images.yaml';
					//console.log($writepath);
					$path = treeValue['path'];
					$sha = treeValue['sha'];
					//console.log($path + ' == ' + $writepath);
					if($path==$writepath)
						{
						repo.writemanual('master',$writepath, $yaml_dump, 'Save', $sha, function(err) { });
						//console.log("writing " + $writepath);
						//alert("saved " + $writepath);
						}
					});
				});

			}
		</script>
		<input type="button" onclick="savethis();" class="button" value="Save Images" />
	</div>
</div>
